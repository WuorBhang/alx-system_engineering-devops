#!/usr/bin/env bash

# Function to convert a string in custom base to decimal
convert_to_decimal() {
    local input="$1"
    local base_chars="$2"
    local base=${#base_chars}
    local len=${#input}
    local value=0

    for ((i=0; i<len; i++)); do
        char="${input:$i:1}"
        pos=$(expr index "$base_chars" "$char")
        if [ "$pos" -eq 0 ]; then
            echo "Invalid character '$char' for base '$base_chars'" >&2
            exit 1
        fi
        digit=$((pos - 1))
        value=$((value * base + digit))
    done
    echo "$value"
}

# Function to convert decimal to a custom base
convert_from_decimal() {
    local number=$1
    local base_chars="$2"
    local base=${#base_chars}
    local result=""

    if [ "$number" -eq 0 ]; then
        echo "${base_chars:0:1}"
        return
    fi

    while [ "$number" -gt 0 ]; do
        digit=$((number % base))
        result="${base_chars:$digit:1}$result"
        number=$((number / base))
    done

    echo "$result"
}

# Main logic
water_base=$(echo -n "water" | awk -v RS="" '{for(i=1;i<=length;i++){if(index(substr($0,1,i-1), substr($0,i,1))==0)printf "%s", substr($0,i,1)}}')
stir_base=$(echo -n "stir" | awk -v RS="" '{for(i=1;i<=length;i++){if(index(substr($0,1,i-1), substr($0,i,1))==0)printf "%s", substr($0,i,1)}}')
bestchol_base=$(echo -n "bestchol" | awk -v RS="" '{for(i=1;i<=length;i++){if(index(substr($0,1,i-1), substr($0,i,1))==0)printf "%s", substr($0,i,1)}}')

water_dec=$(convert_to_decimal "$WATER" "$water_base")
stir_dec=$(convert_to_decimal "$STIR" "$stir_base")

sum=$((water_dec + stir_dec))

convert_from_decimal "$sum" "$bestchol_base"
